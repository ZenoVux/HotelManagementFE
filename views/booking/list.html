<app-layout name="">

    <div class="row mb-2">
        <div class="col-sm-4"></div>
        <div class="col-sm-4 text-center">
            <div id="loading-spinner" ng-show="loading">
                <i class="fa fa-spinner fa-spin" style="font-size: 30px"></i>
            </div>
        </div>
        <div class="col-sm-4">
            <div class="text-sm-end">
                <a class="btn btn-success btn-lg" ng-href="/#!/bookings/create" role="button">
                    <i class="fas fa-plus"></i> Create</a>
            </div>
        </div>
    </div>

    <div class="row">

        <div class="col-xl-3 col-sm-6" ng-class="{'active-table': currentTable == 0}">
            <div class="card booking-header booking active" ng-click="toggleTable('bookingTable')">
                <div class="d-flex align-items-center justify-content-center h-100">
                    <h2 class="text-truncate mb-4 mb-lg-5 text-center" style="margin-top: 15%;">
                        {{bookings.length}} BOOKINGS
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-sm-6" ng-class="{'active-table': currentTable == 1}">
            <div class="card booking-header customer" ng-click="toggleTable('customerTable')">
                <div class="d-flex align-items-center justify-content-center h-100">
                    <h2 class="text-truncate mb-4 mb-lg-5 text-center" style="margin-top: 15%;">
                        {{customersInUse.length}} CUSTOMERS
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-sm-6" ng-class="{'active-table': currentTable == 2}">
            <div class="card booking-header confirmed" ng-click="toggleTable('confirmedTable')">
                <div class="d-flex align-items-center justify-content-center h-100">
                    <h2 class="text-truncate mb-4 mb-lg-5 text-center" style="margin-top: 15%;">
                        {{(bookings | filter: {status: 2}).length}} CONFIRMED
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-sm-6" ng-class="{'active-table': currentTable == 3}">
            <div class="card booking-header pending" ng-click="toggleTable('pendingTable')">
                <div class="d-flex align-items-center justify-content-center h-100">
                    <h2 class="text-truncate mb-4 mb-lg-5 text-center" style="margin-top: 15%;">
                        {{(bookings | filter: {status: 1}).length}} PENDING
                    </h2>
                </div>
            </div>
        </div>

    </div>

    <!-- Table booking -->

    <div class="row" ng-show="currentTable == 0">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <table id="bookingTable" class="table table-bordered dt-responsive nowrap w-100"
                        ng-show="showBookingTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Phòng</th>
                                <th>Số người lớn</th>
                                <th>Số trẻ em</th>
                                <th>Ngày đặt</th>
                                <th>Trạng thái</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="booking in bookings">
                                <th>{{booking.code}}</th>
                                <td>{{booking.numOfRoom}}</td>
                                <td>{{booking.adults}}</td>
                                <td>{{booking.childs}}</td>
                                <td>{{booking.createdDate | date:'HH:mm dd-MM-yyyy'}}</td>
                                <td>
                                    <span ng-if="booking.status == 0"
                                        class="badge badge-pill badge-soft-danger font-size-12">Huỷ</span>
                                    <span ng-if="booking.status == 1"
                                        class="badge badge-pill badge-soft-warning font-size-12">Chờ xác nhận</span>
                                    <span ng-if="booking.status == 2"
                                        class="badge badge-pill badge-soft-success font-size-12">Đã xác nhận</span>
                                </td>
                                <td>
                                    <a class="btn btn-outline-secondary btn-sm edit" title="View"
                                        ng-click="viewBooking(booking)">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <!-- Booking modal -->
    <div class="modal fade" id="booking-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="customer-modal-label">{{ bookingInfo.code }}</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">

                                    <div class="table-responsive">
                                        <table class="table table-striped table-nowrap mb-0">
                                            <thead>
                                                <tr>
                                                    <th style="width: 20%;">Khách hàng</th>
                                                    <th>{{bookingInfo.customer.fullName}}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Số điện thoại</td>
                                                    <td>
                                                        {{bookingInfo.customer.phoneNumber}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Email</td>
                                                    <td>
                                                        {{bookingInfo.customer.email}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Số người lớn</td>
                                                    <td>
                                                        {{currentBooking.adults}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Số trẻ em</td>
                                                    <td>
                                                        {{currentBooking.childs}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Ghi chú</td>
                                                    <td>
                                                        {{currentBooking.note}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Số phòng</td>
                                                    <td>
                                                        {{currentBooking.numOfRoom}}
                                                    </td>
                                                </tr>
                                                <!-- Danh sách phòng -->
                                                <tr>
                                                    <td>Danh sách phòng</td>
                                                    <td colspan="2">
                                                        <table class="table table-striped table-nowrap mb-0">
                                                            <thead>
                                                                <tr>
                                                                    <th>Phòng</th>
                                                                    <th>Giá</th>
                                                                    <th>Check-in</th>
                                                                    <th>Check-out</th>
                                                                    <th>Số đêm</th>
                                                                    <th>Ghi chú</th>
                                                                    <th>#</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr ng-repeat="bk in bookingInfo.bkList">
                                                                    <td>{{bk.room.code}}</td>
                                                                    <td>{{bk.room.price | currency: '' : 0}}đ</td>
                                                                    <td>{{bk.checkinExpected | date:'dd-MM-yyyy'}}</td>
                                                                    <td>{{bk.checkoutExpected | date:'dd-MM-yyyy'}}</td>
                                                                    <td>{{(bk.checkoutExpected - bk.checkinExpected) /
                                                                        (1000*60*60*24)}}</td>
                                                                    <td>{{bk.note}}</td>
                                                                    <td>
                                                                        <a class="btn btn-outline-secondary btn-sm edit"
                                                                            title="Edit">
                                                                            <i class="fas fa-pencil-alt"></i>
                                                                        </a>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                                <!-- card footer -->
                                <div class="card-footer">
                                    <div ng-if="currentBooking.status == 0" class="row mb-2">
                                        <div class="alert alert-danger text-center" role="alert">
                                            <h4>ĐÃ HUỶ</h4>
                                        </div>
                                    </div>
                                    <div ng-if="currentBooking.status != 0" class="row mb-2">
                                        <div class="col-sm-5"></div>
                                        <div class="col-sm-6">
                                            <div class="row">
                                                <div class="col-2">
                                                    <label class="col-form-label">Lí do huỷ</label>
                                                </div>
                                                <div class="col-10">
                                                    <textarea type="text" class="form-control"
                                                        ng-model="booking.reasonCancel"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="text-sm-end">
                                                <a class="btn btn-danger btn-lg" ng-click="cancelBooking()"
                                                    role="button">
                                                    Huỷ</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div> <!-- end col -->
                    </div> <!-- end row -->
                </div>
            </div>
        </div>

    </div>

    <!-- Customer table -->

    <div class="row" ng-show="currentTable == 1">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <table id="customerTable" class="table table-bordered dt-responsive  nowrap w-100"
                        ng-show="showCustomerTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Type</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="customer in customersInUse">
                                <th scope="row">{{$index + 1}}</th>
                                <td>{{customer.fullName}}</td>
                                <td>{{customer.phoneNumber}}</td>
                                <td>{{customer.email}}</td>
                                <td>
                                    <span class="badge rounded-pill" ng-class="{'bg-warning': customer.customerType.code == 'member', 
                                        'bg-success': customer.customerType.code == 'vip'}">
                                        {{customer.customerType.name}}
                                    </span>
                                </td>
                                <td>
                                    <a class="btn btn-outline-secondary btn-sm edit" title="View"
                                        ng-click="viewCustomer(customer)">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a class="btn btn-outline-secondary btn-sm edit" title="Edit"
                                        href="#!/customers/edit/{{customer.id}}">
                                        <i class="fas fa-pencil-alt"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <!-- Confirmed table -->

    <div class="row" ng-show="currentTable == 2">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <table id="confirmedTable" class="table table-bordered dt-responsive  nowrap w-100"
                        ng-show="showConfirmedTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Phòng</th>
                                <th>Người lớn tối đa</th>
                                <th>Trẻ em tối đa</th>
                                <th>Trạng thái</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="booking in bookings" ng-if="booking.status === 2">
                                <th>{{booking.code}}</th>
                                <td>{{booking.checkin | date:'dd-MM-yyyy'}}</td>
                                <td>{{booking.checkout | date:'dd-MM-yyyy'}}</td>
                                <td>{{booking.numOfRoom}}</td>
                                <td>{{booking.adults}}</td>
                                <td>{{booking.childs}}</td>
                                <td>
                                    <span class="badge badge-pill badge-soft-success font-size-12">Đã xác nhận</span>
                                </td>
                                <td>
                                    <a class="btn btn-outline-secondary btn-sm edit" title="View"
                                        ng-click="viewBooking(booking)">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <!-- Pending table -->

    <div class="row" ng-show="currentTable == 3">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <table id="pendingTable" class="table table-bordered dt-responsive  nowrap w-100"
                        ng-show="showPendingTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Phòng</th>
                                <th>Người lớn tối đa</th>
                                <th>Trẻ em tối đa</th>
                                <th>Trạng thái</th>
                                <th>Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="booking in bookings" ng-if="booking.status === 1">
                                <th>{{booking.code}}</th>
                                <td>{{booking.checkin | date:'dd-MM-yyyy'}}</td>
                                <td>{{booking.checkout | date:'dd-MM-yyyy'}}</td>
                                <td>{{booking.numOfRoom}}</td>
                                <td>{{booking.adults}}</td>
                                <td>{{booking.childs}}</td>
                                <td>
                                    <span class="badge badge-pill badge-soft-warning font-size-12">Chờ xác nhận</span>
                                </td>
                                <td>
                                    <a class="btn btn-outline-secondary btn-sm edit" title="View"
                                        ng-click="viewBooking(booking)">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

</app-layout>